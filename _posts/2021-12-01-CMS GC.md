---
layout: post
title: "CMS GC"
tags: ["gc", "cms", "java"]
---

java CMS垃圾回收器简单介绍.

## CMS老年代回收经过如下阶段：

|     阶段     |  是否STW   |                                描述                                |
|:----------:|:--------:|:----------------------------------------------------------------:|
|    初始标记    |    是     |                     标记老年代中可达对象，包括可以从年轻到访问的对象                     |
|    并发标记    |    否     | 从GCRoot开始遍历可达对象，因为在这个阶段中对象应用还在发生变化，所以这个阶段中老年代新创建的或者新晋升的对象都会标记为存活 |
|    重新标记    |    是     |                    查找并发标记阶段因为引用改变导致的未标记的无用对象                     |
|    并发清除    |    否     |    回收标记阶段标记的无用对象，被回收的对象内存放入一个free list，用于后续的内存分配，无用对象的内存可能被合并    |
|     重置     |    否     |                           清理GC使用的数据结构                            |

CMS老年代在运行一段时间后，对象会分散地位于老年代，因为CMS并不会主动压缩，直到发生full GC。

## CMS年轻代回收：

1、年轻代被分为一个eden和两个survivor

2、两个survivor同一时间只使用其中一个，发生GC时，将eden和使用中的survivor中的存货对象复制到另一个survivor，达到晋升到老年代资格的对象会晋升到老年代。

3、youngGC完成后，eden和之前使用的survivor都会被清空

